<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>DNA Monitor</title>
    <link rel="stylesheet" href="style.css">

  </head>
  <body>
    <div id="chart"></div>
    <label for="psp">Power</label><input id="psp" type="number"> W <input id="setp" type="button" value="set">
    <label for="tsp">Temperature</label><input id="tsp" type="number">째
    <select id="degreeunit">
        <option value="C">C</option>
        <option value="F">F</option>
    </select>
    <input id="sett" type="button" value="set">
  </body>

  <script>
    // You can also require other files to run in this process
    require('./renderer.js')
    var ipc = require('electron').ipcRenderer;

    var running;
    var degreeunit;
    var start;
    ipc.on('values', function (event, data) {
        if (data.p.match(/W/)) {
            if (!running) {
                chart.series[0].setData([]);
                chart.series[1].setData([]);
                chart.redraw();
                start = (new Date()).getTime();
                running = true;
            }

            if (running && !degreeunit && data.t.match(/C/)) {
                chart.yAxis[0].update({
                    labels: {
                        format: '{value}째C'
                    }
                });
                $('#degreeunit').val('C');
                degreeunit = true;

            } else if (running && !degreeunit && data.t.match(/F/)) {
                chart.yAxis[0].update({
                    labels: {
                        format: '{value}째F'
                    }
                });
                $('#degreeunit').val('F');
                degreeunit = true;
            }

            var t = parseFloat(data.t.replace('C', ''));
            var p = parseFloat(data.p.replace('W', ''));
            var elapsed = ((new Date()).getTime() - start) / 1000;
            chart.series[0].addPoint([elapsed, t], true, false, false);
            chart.series[1].addPoint([elapsed, p], true, false, false);
      } else {
        running = false;
        degreeunit = false;
      }
    });

    ipc.on('setpoints', function (event, data) {
        $('#psp').val(parseFloat(data.p.replace('W', '')));
        $('#tsp').val(parseFloat(data.t.replace('C', '')));
    });

    const $ = jQuery = require('jquery')
    const Highcharts = require('highcharts')

    $('#setp').click(function () {
        ipc.send('setp', $('#psp').val());
    });
    $('#sett').click(function () {
        var val = $('#tsp').val() + $('#degreeunit').val();
        ipc.send('sett', val);
    });

    require('highcharts/themes/gray.js')(Highcharts)

    var series;
    var chart;
    $(document).ready(function() {
      chart = new Highcharts.Chart({
        chart: {
          renderTo: 'chart',
          type: 'line'

        },
        legend: {
          enabled: false
        },
        title: {text: ''},
        xAxis: {
          min: 0
        },
        yAxis: [{ // Primary yAxis
          labels: {
            format: '{value}째C',
            style: {
              color: Highcharts.getOptions().colors[2]
            }

          },
          title: {
            text: 'Temperature',
            style: {
              color: Highcharts.getOptions().colors[2]
            }
          },
          opposite: false

        },
          { // Primary yAxis
            labels: {
              format: '{value} W',
              style: {
                color: Highcharts.getOptions().colors[3]
              }
            },
            title: {
              text: 'Power',
              style: {
                color: Highcharts.getOptions().colors[3]
              }
            },
            opposite: true

          }],
        plotOptions: {
          line: {
            marker: {
              enabled: false
            }
          }
        },
        series: [
          {
            name: 'Temperature',
            data: [],
            yAxis: 0,
            color: Highcharts.getOptions().colors[2]
          },
          {
            name: 'Power',
            data: [],
            yAxis: 1,
            color: Highcharts.getOptions().colors[3]
          }
        ]


      });
    })
  </script>
</html>
